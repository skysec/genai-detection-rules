rules:
  - id: detect-embeddings-huggingface
    languages:
      - python
    severity: INFO
    message: "Detected HuggingFace embeddings usage: SentenceTransformers or Transformers embedding generation"
    pattern-either:
      # Core SentenceTransformers imports - VERY HIGH CONFIDENCE
      - pattern: from sentence_transformers import SentenceTransformer
      - pattern: from sentence_transformers import SentenceTransformer, $REST
      - pattern: import sentence_transformers
      - pattern: from sentence_transformers import util

      # HuggingFace Transformers embedding imports - HIGH CONFIDENCE
      - pattern: from transformers import AutoTokenizer, AutoModel
      - pattern: from transformers import AutoModel
      - pattern: from transformers import pipeline

      # SentenceTransformer model instantiation - VERY HIGH CONFIDENCE
      - pattern: SentenceTransformer($MODEL)
      - pattern: $VAR = SentenceTransformer($MODEL_NAME)
      - pattern: embedding_model = SentenceTransformer(...)

      # Popular embedding models - HIGH CONFIDENCE
      - pattern: SentenceTransformer("all-MiniLM-L6-v2")
      - pattern: SentenceTransformer("all-mpnet-base-v2")
      - pattern: SentenceTransformer("paraphrase-MiniLM-L6-v2")
      - pattern: SentenceTransformer("multi-qa-MiniLM-L6-cos-v1")
      - pattern: SentenceTransformer("sentence-transformers/$MODEL")

      # AutoModel embedding patterns - HIGH CONFIDENCE
      - pattern: AutoModel.from_pretrained($MODEL)
      - pattern: $MODEL = AutoModel.from_pretrained($MODEL_NAME)
      - pattern: AutoTokenizer.from_pretrained($MODEL)

      # Embedding generation via encode() - VERY HIGH CONFIDENCE
      - pattern: $MODEL.encode($TEXTS)
      - pattern: $EMBEDDINGS = $MODEL.encode($TEXTS)
      - pattern: embeddings = $MODEL.encode(...)
      - pattern: $MODEL.encode($TEXTS, convert_to_tensor=$BOOL)
      - pattern: $MODEL.encode($TEXTS, show_progress_bar=$BOOL)

      # SentenceTransformers utility functions - VERY HIGH CONFIDENCE
      - pattern: sentence_transformers.util.semantic_search($QUERY_EMB, $CORPUS_EMB)
      - pattern: util.semantic_search($QUERY_EMB, $CORPUS_EMB)
      - pattern: sentence_transformers.util.cos_sim($EMB1, $EMB2)
      - pattern: util.cos_sim($EMB1, $EMB2)

      # Model similarity methods - HIGH CONFIDENCE
      - pattern: $MODEL.similarity($TEXTS1, $TEXTS2)

      # HuggingFace pipeline for embeddings - HIGH CONFIDENCE
      - pattern: pipeline("feature-extraction")
      - pattern: pipeline("feature-extraction", model=$MODEL)
      - pattern: $PIPE = pipeline("feature-extraction")

      # Model management - HIGH CONFIDENCE
      - pattern: SentenceTransformer.from_pretrained($MODEL)
      - pattern: $MODEL.save_pretrained($PATH)

      # Cross-encoder patterns - HIGH CONFIDENCE
      - pattern: from sentence_transformers import CrossEncoder
      - pattern: CrossEncoder($MODEL)
      - pattern: $CROSS_ENCODER.predict($PAIRS)

      # Advanced embedding operations - MEDIUM CONFIDENCE
      - pattern: from sentence_transformers.evaluation import $EVALUATOR
      - pattern: $MODEL.evaluate($EVALUATOR)

    metadata:
      references:
        - https://www.sbert.net/
        - https://huggingface.co/sentence-transformers
        - https://huggingface.co/docs/transformers/main_classes/model
      category: maintainability
      technology:
        - genAI
        - embeddings
        - sentence-transformers
        - huggingface
        - transformers
        - text-embeddings
      confidence: HIGH
      subcategory:
        - embeddings