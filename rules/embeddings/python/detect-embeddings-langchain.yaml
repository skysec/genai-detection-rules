rules:
  - id: detect-embeddings-langchain
    languages:
      - python
    severity: INFO
    message: "Detected LangChain embeddings usage: Text embeddings, vector generation, or embedding model patterns"
    pattern-either:
      # Embedding imports
      - pattern: from langchain_openai import OpenAIEmbeddings
      - pattern: from langchain_community.embeddings import $EMBEDDINGS
      - pattern: from langchain.embeddings import $EMBEDDINGS
      - pattern: from langchain_huggingface import HuggingFaceEmbeddings
      - pattern: from langchain_cohere import CohereEmbeddings
      # Embedding instantiation
      - pattern: $EMBEDDINGS = OpenAIEmbeddings()
      - pattern: embeddings = OpenAIEmbeddings(...)
      - pattern: $VAR = HuggingFaceEmbeddings(...)
      - pattern: $VAR = CohereEmbeddings(...)
      # Vector store creation with embeddings
      - pattern: from langchain_chroma import Chroma
      - pattern: from langchain_pinecone import Pinecone
      - pattern: from langchain_weaviate import Weaviate
      - pattern: vectorstore = Chroma.from_documents($DOCS, embeddings)
      - pattern: $STORE = $VECTORSTORE.from_documents($DOCS, $EMBEDDINGS)
      - pattern: Chroma.from_documents(..., embeddings=...)
      # Embedding usage patterns
      - pattern: embeddings.embed_documents($DOCS)
      - pattern: embeddings.embed_query($QUERY)
      - pattern: $EMBEDDINGS.embed_documents(...)
      - pattern: $EMBEDDINGS.embed_query(...)
      # Vector store with embedding configuration
      - pattern: |
          vectorstore = $STORE(
              ...,
              embedding_function=$EMBEDDINGS,
              ...
          )
      # Explicit embedding usage - VERY HIGH CONFIDENCE
      - pattern: $EMBEDDINGS.embed_documents($DOCS)
      - pattern: $EMBEDDINGS.embed_query($QUERY)
      - pattern: $RESULT = $EMBEDDINGS.embed_documents($DOCS)
      - pattern: $RESULT = $EMBEDDINGS.embed_query($QUERY)

      # Vector store creation with explicit embeddings - HIGH CONFIDENCE
      - pattern: Chroma.from_documents($DOCS, $EMBEDDINGS)
      - pattern: FAISS.from_documents($DOCS, $EMBEDDINGS)
      - pattern: Pinecone.from_documents($DOCS, $EMBEDDINGS)
      - pattern: $STORE.from_documents($DOCS, embeddings=$EMBEDDINGS)

      # Embedding function parameter - HIGH CONFIDENCE (in function calls only)
      - pattern: |
          $FUNC(
              ...,
              embedding_function=$EMBEDDINGS,
              ...
          )
      - pattern: |
          $FUNC(
              ...,
              embeddings=$EMBEDDINGS,
              ...
          )
    metadata:
      references:
        - https://python.langchain.com/docs/modules/data_connection/text_embedding/
        - https://python.langchain.com/docs/integrations/text_embedding/
      category: maintainability
      technology:
        - genAI
        - LLMs
        - embeddings
        - vector-search
        - text-embeddings
      confidence: HIGH
      subcategory:
        - embeddings