rules:
  - id: detect-memory-langchain
    languages:
      - python
    severity: INFO
    message: "Detected LangChain memory usage: Conversation memory, chat history, or context retention patterns"
    pattern-either:
      # Memory imports
      - pattern: from langchain.memory import ConversationBufferMemory
      - pattern: from langchain.memory import ConversationSummaryMemory
      - pattern: from langchain.memory import ConversationBufferWindowMemory
      - pattern: from langchain.memory import ConversationSummaryBufferMemory
      - pattern: from langchain.memory import $MEMORY
      - pattern: from langchain.chains import ConversationChain
      # Memory instantiation
      - pattern: $MEMORY = ConversationBufferMemory()
      - pattern: $MEMORY = ConversationSummaryMemory(llm=$LLM)
      - pattern: $MEMORY = ConversationBufferWindowMemory(k=$K)
      - pattern: buffer_memory = ConversationBufferMemory(...)
      - pattern: summary_memory = ConversationSummaryMemory(...)
      # Conversation chain with memory
      - pattern: |
          $CHAIN = ConversationChain(
              llm=$LLM,
              memory=$MEMORY,
              ...
          )
      - pattern: ConversationChain(..., memory=$MEMORY, ...)
      # Memory-specific method calls - VERY HIGH CONFIDENCE
      - pattern: $MEMORY.save_context($INPUTS, $OUTPUTS)
      - pattern: "$MEMORY.load_memory_variables({})"
      - pattern: $MEMORY.load_memory_variables($DICT)

      # Chat message history imports - HIGH CONFIDENCE
      - pattern: from langchain.memory.chat_message_histories import RedisChatMessageHistory
      - pattern: from langchain.memory.chat_message_histories import PostgresChatMessageHistory
      - pattern: from langchain.memory.chat_message_histories import FileChatMessageHistory
      - pattern: from langchain.memory.chat_message_histories import $HISTORY

      # Memory parameters in function calls - HIGH CONFIDENCE
      - pattern: |
          $FUNC(
              ...,
              memory=$MEMORY,
              ...
          )
      - pattern: |
          $FUNC(
              ...,
              chat_memory=$MEMORY,
              ...
          )
    metadata:
      references:
        - https://python.langchain.com/docs/modules/memory/
        - https://python.langchain.com/docs/modules/memory/types/
      category: maintainability
      technology:
        - genAI
        - LLMs
        - memory
        - conversation
        - chat-history
      confidence: HIGH
      subcategory:
        - memory